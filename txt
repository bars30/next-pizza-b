SELECT 
    c.id AS category_id, 
    c.name AS category_name,
    json_agg(
        json_build_object(
            'id', p.id,
            'name', p.name,
            'imageUrl', p."imageUrl", 
            'ingredients', (
                SELECT json_agg(i)
                FROM "Ingredient" i
                WHERE i."productId" = p.id
            ),
            'items', (
                SELECT json_agg(it)
                FROM "ProductItem" it
                WHERE it."productId" = p.id  -- Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¸Ğ¼Ñ Ğ¿Ğ¾Ğ»Ñ
            )
        )
    ) AS products
FROM "Category" c
LEFT JOIN "Product" p ON p."categoryId" = c.id
GROUP BY c.id; 


category_id
category_name
products
1	ĞŸĞ¸Ñ†Ñ†Ñ‹	[object Object]
2	Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ°Ğº	[object Object],[object Object]
3	Ğ—Ğ°ĞºÑƒÑĞºĞ¸	[object Object],[object Object],[object Object],[object Object],[object Object]
4	ĞšĞ¾ĞºÑ‚ĞµĞ¹Ğ»Ğ¸	[object Object],[object Object],[object Object],[object Object]
5	ĞĞ°Ğ¿Ğ¸Ñ‚ĞºĞ¸	[object Object],[object Object],[object Object],[object Object],[object Object],[object Object]



ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


SELECT 
    c.id AS category_id, 
    c.name AS category_name,
    json_agg(
        json_build_object(
            'id', p.id,
            'name', p.name,
            'imageUrl', p."imageUrl", 
            'ingredients', (
                SELECT json_agg(i)
                FROM "Ingredient" i
                WHERE i."productId" = p.id
            ),
            'items', (
                SELECT json_agg(it)
                FROM "ProductItem" it
                WHERE it."productId" = p.id
            )
        )
    )::TEXT AS products -- ĞŸÑ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·ÑƒĞµĞ¼ JSON Ğ² Ñ‚ĞµĞºÑÑ‚
FROM "Category" c
LEFT JOIN "Product" p ON p."categoryId" = c.id
GROUP BY c.id;


category_id
category_name
products
1	ĞŸĞ¸Ñ†Ñ†Ñ‹	[{"id" : null, "name" : null, "imageUrl" : null, "ingredients" : null, "items" : null}]
2	Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ°Ğº	[{"id" : 2, "name" : "ĞĞ¼Ğ»ĞµÑ‚ Ñ Ğ¿ĞµĞ¿Ğ¿ĞµÑ€Ğ¾Ğ½Ğ¸", "imageUrl" : "https://media.dodostatic.net/image/r:292x292/11EE94ECF33B0C46BA410DEC1B1DD6F8.webp", "ingredients" : null, "items" : null}, {"id" : 1, "name" : "ĞĞ¼Ğ»ĞµÑ‚ Ñ Ğ²ĞµÑ‚Ñ‡Ğ¸Ğ½Ğ¾Ğ¹ Ğ¸ Ğ³Ñ€Ğ¸Ğ±Ğ°Ğ¼Ğ¸", "imageUrl" : "https://media.dodostatic.net/image/r:292x292/11EE7970321044479C1D1085457A36EB.webp", "ingredients" : null, "items" : null}]
3	Ğ—Ğ°ĞºÑƒÑĞºĞ¸	[{"id" : 5, "name" : "ĞšÑƒÑ€Ğ¸Ğ½Ñ‹Ğµ Ğ½Ğ°Ğ³Ğ³ĞµÑ‚ÑÑ‹", "imageUrl" : "https://media.dodostatic.net/image/r:292x292/11EE7D618B5C7EC29350069AE9532C6E.webp", "ingredients" : null, "items" : null}, {"id" : 6, "name" : "ĞšĞ°Ñ€Ñ‚Ğ¾Ñ„ĞµĞ»ÑŒ Ğ¸Ğ· Ğ¿ĞµÑ‡Ğ¸ Ñ ÑĞ¾ÑƒÑĞ¾Ğ¼ ğŸŒ±", "imageUrl" : "https://media.dodostatic.net/image/r:292x292/11EED646A9CD324C962C6BEA78124F19.webp", "ingredients" : null, "items" : null}, {"id" : 7, "name" : "Ğ”Ğ¾Ğ´ÑÑ‚ĞµÑ€", "imageUrl" : "https://media.dodostatic.net/image/r:292x292/11EE796F96D11392A2F6DD73599921B9.webp", "ingredients" : null, "items" : null}, {"id" : 4, "name" : "Ğ”ÑĞ½Ğ²Ğ¸Ñ‡ Ğ²ĞµÑ‚Ñ‡Ğ¸Ğ½Ğ° Ğ¸ ÑÑ‹Ñ€", "imageUrl" : "https://media.dodostatic.net/image/r:292x292/11EE796FF0059B799A17F57A9E64C725.webp", "ingredients" : null, "items" : null}, {"id" : 8, "name" : "ĞÑÑ‚Ñ€Ñ‹Ğ¹ Ğ”Ğ¾Ğ´ÑÑ‚ĞµÑ€ ğŸŒ¶ï¸ğŸŒ¶ï¸", "imageUrl" : "https://media.dodostatic.net/image/r:292x292/11EE796FD3B594068F7A752DF8161D04.webp", "ingredients" : null, "items" : null}]
4	ĞšĞ¾ĞºÑ‚ĞµĞ¹Ğ»Ğ¸	[{"id" : 9, "name" : "Ğ‘Ğ°Ğ½Ğ°Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¼Ğ¾Ğ»Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ¾ĞºÑ‚ĞµĞ¹Ğ»ÑŒ", "imageUrl" : "https://media.dodostatic.net/image/r:292x292/11EEE20B8772A72A9B60CFB20012C185.webp", "ingredients" : null, "items" : null}, {"id" : 10, "name" : "ĞšĞ°Ñ€Ğ°Ğ¼ĞµĞ»ÑŒĞ½Ğ¾Ğµ ÑĞ±Ğ»Ğ¾ĞºĞ¾ Ğ¼Ğ¾Ğ»Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ¾ĞºÑ‚ĞµĞ¹Ğ»ÑŒ", "imageUrl" : "https://media.dodostatic.net/image/r:292x292/11EE79702E2A22E693D96133906FB1B8.webp", "ingredients" : null, "items" : null}, {"id" : 11, "name" : "ĞœĞ¾Ğ»Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ¾ĞºÑ‚ĞµĞ¹Ğ»ÑŒ Ñ Ğ¿ĞµÑ‡ĞµĞ½ÑŒĞµĞ¼ ĞÑ€ĞµĞ¾", "imageUrl" : "https://media.dodostatic.net/image/r:292x292/11EE796FA1F50F8F8111A399E4C1A1E3.webp", "ingredients" : null, "items" : null}, {"id" : 12, "name" : "ĞšĞ»Ğ°ÑÑĞ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¼Ğ¾Ğ»Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ¾ĞºÑ‚ĞµĞ¹Ğ»ÑŒ ğŸ‘¶", "imageUrl" : "https://media.dodostatic.net/image/r:292x292/11EE796F93FB126693F96CB1D3E403FB.webp", "ingredients" : null, "items" : null}]
5	ĞĞ°Ğ¿Ğ¸Ñ‚ĞºĞ¸	[{"id" : 17, "name" : "ĞšĞ¾Ñ„Ğµ Ğ›Ğ°Ñ‚Ñ‚Ğµ", "imageUrl" : "https://media.dod"}]

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


SELECT 
    c.id AS category_id, 
    c.name AS category_name,
    json_agg(
        json_build_object(
            'id', p.id,
            'name', p.name,
            'imageUrl', p."imageUrl", 
            'ingredients', p.ingredients, -- Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ±ĞµÑ€ĞµĞ¼ Ğ¸Ğ½Ğ³Ñ€ĞµĞ´Ğ¸ĞµĞ½Ñ‚Ñ‹ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ Ğ¸Ğ· Ğ¿Ğ¾Ğ»Ñ Ğ² Product
            'items', (
                SELECT json_agg(it)
                FROM "ProductItem" it
                WHERE it."productId" = p.id
            )
        )
    )::TEXT AS products -- ĞŸÑ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·ÑƒĞµĞ¼ JSON Ğ² Ñ‚ĞµĞºÑÑ‚
FROM "Category" c
LEFT JOIN "Product" p ON p."categoryId" = c.id
GROUP BY c.id;

category_id
category_name
products
1	ĞŸĞ¸Ñ†Ñ†Ñ‹	[{"id" : 19, "name" : "Ğ§Ğ¾Ñ€Ğ¸Ğ·Ğ¾ Ñ„Ñ€ĞµÑˆ", "imageUrl" : "https://media.dodostatic.com/image/r:584x584/11EF866913F5B8298A23EAEAAF50E556.avif", "ingredients" : [27], "items" : null}, {"id" : 18, "name" : "ĞšÑ€ĞµĞ²ĞµÑ‚ĞºĞ¸ ÑĞ¾ ÑĞ»Ğ°Ğ´ĞºĞ¸Ğ¼ Ñ‡Ğ¸Ğ»Ğ¸", "imageUrl" : "https://media.dodostatic.com/image/r:584x584/11EF86E9C26CFCD393EF4084A8CEF7B9.avif", "ingredients" : [25,26], "items" : null}, {"id" : 20, "name" : "ĞšĞ°Ğ¿Ñ€Ğ¸Ñ‡Ğ¾Ğ·Ğ°", "imageUrl" : "https://media.dodostatic.com/image/r:584x584/11EECB6A7A0A9CD1B64A1C5C22F4298F.avif", "ingredients" : [28], "items" : null}]
2	Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ°Ğº	[{"id" : 1, "name" : "ĞĞ¼Ğ»ĞµÑ‚ Ñ Ğ²ĞµÑ‚Ñ‡Ğ¸Ğ½Ğ¾Ğ¹ Ğ¸ Ğ³Ñ€Ğ¸Ğ±Ğ°Ğ¼Ğ¸", "imageUrl" : "https://media.dodostatic.net/image/r:292x292/11EE7970321044479C1D1085457A36EB.webp", "ingredients" : [1,2,3], "items" : null}, {"id" : 2, "name" : "ĞĞ¼Ğ»ĞµÑ‚ Ñ Ğ¿ĞµĞ¿Ğ¿ĞµÑ€Ğ¾Ğ½Ğ¸", "imageUrl" : "https://media.dodostatic.net/image/r:292x292/11EE94ECF33B0C46BA410DEC1B1DD6F8.webp", "ingredients" : [2,4], "items" : null}]
3	Ğ—Ğ°ĞºÑƒÑĞºĞ¸	[{"id" : 8, "name" : "ĞÑÑ‚Ñ€Ñ‹Ğ¹ Ğ”Ğ¾Ğ´ÑÑ‚ĞµÑ€ ğŸŒ¶ï¸ğŸŒ¶ï¸", "imageUrl" : "https://media.dodostatic.net/image/r:292x292/11EE796FD3B594068F7A752DF8161D04.webp", "ingredients" : [13,14], "items" : null}, {"id" : 5, "name" : "ĞšÑƒÑ€Ğ¸Ğ½Ñ‹Ğµ Ğ½Ğ°Ğ³Ğ³ĞµÑ‚ÑÑ‹", "imageUrl" : "https://media.dodostatic.net/image/r:292x292/11EE7D618B5C7EC29350069AE9532C6E.webp", "ingredients" : [8,9], "items" : null}, {"id" : 4, "name" : "Ğ”ÑĞ½Ğ²Ğ¸Ñ‡ Ğ²ĞµÑ‚Ñ‡Ğ¸Ğ½Ğ° Ğ¸ ÑÑ‹Ñ€", "imageUrl" : "https://media.dodostatic.net/image/r:292x292/11EE796FF0059B799A17F57A9E64C725.webp", "ingredients" : [6,7], "items" : null}, {"id" : 6, "name" : "ĞšĞ°Ñ€Ñ‚Ğ¾Ñ„ĞµĞ»ÑŒ Ğ¸Ğ· Ğ¿ĞµÑ‡Ğ¸ Ñ ÑĞ¾ÑƒÑĞ¾Ğ¼ ğŸŒ±", "imageUrl" : "https://media.dodostatic.net/image/r:292x292/11EED646A9CD324C962C6BEA78124F19.webp", "ingredients" : [10], "items" : null}, {"id" : 7, "name" : "Ğ”Ğ¾Ğ´ÑÑ‚ĞµÑ€", "imageUrl" : "https://media.dodostatic.net/image/r:292x292/11EE796F96D11392A2F6DD73599921B9.webp", "ingredients" : [11,12], "items" : null}]
4	ĞšĞ¾ĞºÑ‚ĞµĞ¹Ğ»Ğ¸	[{"id" : 10, "name" : "ĞšĞ°Ñ€Ğ°Ğ¼ĞµĞ»ÑŒĞ½Ğ¾Ğµ ÑĞ±Ğ»Ğ¾ĞºĞ¾ Ğ¼Ğ¾Ğ»Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ¾ĞºÑ‚ĞµĞ¹Ğ»ÑŒ", "imageUrl" : "https://media.dodostatic.net/image/r:292x292/11EE79702E2A22E693D96133906FB1B8.webp", "ingredients" : [16,17], "items" : null}, {"id" : 11, "name" : "ĞœĞ¾Ğ»Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ¾ĞºÑ‚ĞµĞ¹Ğ»ÑŒ Ñ Ğ¿ĞµÑ‡ĞµĞ½ÑŒĞµĞ¼ ĞÑ€ĞµĞ¾", "imageUrl" : "https://media.dodostatic.net/image/r:292x292/11EE796FA1F50F8F8111A399E4C1A1E3.webp", "ingredients" : [18], "items" : null}, {"id" : 9, "name" : "Ğ‘Ğ°Ğ½Ğ°Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¼Ğ¾Ğ»Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ¾ĞºÑ‚ĞµĞ¹Ğ»ÑŒ", "imageUrl" : "https://media.dodostatic.net/image/r:292x292/11EEE20B8772A72A9B60CFB20012C185.webp", "ingredients" : [15], "items" : null}, {"id" : 12, "name" : "ĞšĞ»Ğ°ÑÑĞ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¼Ğ¾Ğ»Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ¾ĞºÑ‚ĞµĞ¹Ğ»ÑŒ ğŸ‘¶", "imageUrl" : "https://media.dodostatic.net/image/r:292x292/11EE796F93FB126693F96CB1D3E403FB.webp", "ingredients" : [19], "items" : null}]
5	ĞĞ°Ğ¿Ğ¸Ñ‚ĞºĞ¸	[{"id" : 3, "name" : "ĞšĞ¾Ñ„Ğµ Ğ›Ğ°Ñ‚Ñ‚Ğµ", "imageUrl" : "https://media.dodos}]

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
// Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸ Ğ¸Ğ½Ğ³Ñ€ĞµĞ´ĞµĞ½Ñ‚Ğ¾Ğ² Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°

SELECT i.*
FROM "Product" p
JOIN "Ingredient" i ON i.id = ANY(p.ingredients)
WHERE p.id = 1;
 

 id
name
price
imageUrl
createdAt
updatedAt
1	Ğ¡Ñ‹Ñ€Ğ½Ñ‹Ğ¹ Ğ±Ğ¾Ñ€Ñ‚Ğ¸Ğº	179	https://cdn.dodostatic.net/static/Img/Ingredients/99f5cb91225b4875bd06a26d2e842106.png	Sat Dec 14 2024 15:45:19 GMT+0400 (Armenia Standard Time)	Sat Dec 14 2024 15:45:19 GMT+0400 (Armenia Standard Time)
2	Ğ¡Ğ»Ğ¸Ğ²Ğ¾Ñ‡Ğ½Ğ°Ñ Ğ¼Ğ¾Ñ†Ğ°Ñ€ĞµĞ»Ğ»Ğ°	79	https://cdn.dodostatic.net/static/Img/Ingredients/cdea869ef287426386ed634e6099a5ba.png	Sat Dec 14 2024 15:45:19 GMT+0400 (Armenia Standard Time)	Sat Dec 14 2024 15:45:19 GMT+0400 (Armenia Standard Time)
3	Ğ¡Ñ‹Ñ€Ñ‹ Ñ‡ĞµĞ´Ğ´ĞµÑ€ Ğ¸ Ğ¿Ğ°Ñ€Ğ¼ĞµĞ·Ğ°Ğ½	79	https://cdn.dodostatic.net/static/Img/Ingredients/000D3A22FA54A81411E9AFA69C1FE796	Sat Dec 14 2024 15:45:19 GMT+0400 (Armenia Standard Time)	Sat Dec 14 2024 15:45:19 GMT+0400 (Armenia Standard Time)


âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…












